(this["webpackJsonpantd-demo"]=this["webpackJsonpantd-demo"]||[]).push([[0],{240:function(e,t,a){e.exports=a(463)},245:function(e,t,a){},304:function(e,t,a){},318:function(e,t,a){},457:function(e,t){},463:function(e,t,a){"use strict";a.r(t);var n,r,o,c,s,l=a(0),i=a.n(l),p=a(5),h=a.n(p),u=a(24),d=a(75),m=(a(245),a(81),a(32)),b=a(17),f=a(19),y=a(22),k=a(20),E=a(23),O=a(66),v=(a(179),a(44)),g=(a(72),a(4)),j=m.a.Sider,C=Object(u.b)("layers")(n=Object(u.c)(n=function(e){function t(){var e,a;Object(b.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(y.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(r)))).state={collapsed:!1},a.onCollapse=function(e){a.setState({collapsed:e})},a}return Object(E.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=this.props,t=e.location,a=e.layers;return i.a.createElement(j,null,i.a.createElement("div",{className:"logo"}),i.a.createElement(v.a,{theme:"dark",mode:"vertical",defaultSelectedKeys:["/"],selectedKeys:[t.pathname]},i.a.createElement(v.a.Item,{key:"/deploy"},i.a.createElement(d.b,{to:"/deploy"},i.a.createElement(g.a,{type:"download"}),"\u90e8\u7f72")),i.a.createElement(v.a.Item,{key:"/notifications"},i.a.createElement(d.b,{to:"/notifications"},i.a.createElement(g.a,{type:"dashboard"}),"\u96c6\u7fa4\u7ba1\u7406"))),i.a.createElement(v.a,{theme:"dark",mode:"vertical",selectable:!1,onClick:function(e){"hosts"===e.key&&(a.hostListVisible=!0)}},i.a.createElement(v.a.Item,{key:"hosts"},i.a.createElement(g.a,{type:"deployment-unit"}),"\u914d\u7f6e\u673a\u5668"),i.a.createElement(v.a.Item,{key:"settings"},i.a.createElement(g.a,{type:"setting"}),"\u8bbe\u7f6e"),i.a.createElement(v.a.SubMenu,{key:"language",title:i.a.createElement("span",null,i.a.createElement(g.a,{type:"global"}),"\u8bed\u8a00")},i.a.createElement(v.a.Item,{key:"zh"},"\u7b80\u4f53\u4e2d\u6587"),i.a.createElement(v.a.Item,{key:"en"},"\u82f1\u6587"))))}}]),t}(i.a.Component))||n)||n,S=Object(O.f)(C),w=(a(304),function(e){function t(){return Object(b.a)(this,t),Object(y.a)(this,Object(k.a)(t).apply(this,arguments))}return Object(E.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return i.a.createElement(m.a,null,"Hello World Home")}}]),t}(i.a.Component)),P=(a(229),a(140)),x=(a(194),a(68)),A=a(78),D=a(34),N=a.n(D),H=(a(95),a(48)),I=(a(116),a(52)),V=(a(63),a(18)),_=(a(198),a(91)),T=(a(196),a(67)),K=(a(197),a(42)),F=(a(199),a(104)),L=(a(160),a(41)),B=a(2),R=a.n(B);a(318);function J(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function z(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?J(a,!0).forEach((function(t){Object(A.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):J(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var M,q,G,Q=Object(u.c)(r=function(e){function t(){return Object(b.a)(this,t),Object(y.a)(this,Object(k.a)(t).apply(this,arguments))}return Object(E.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"host-view-vis-dc"},i.a.createElement("div",{className:"host-view-vis-dc-title"},this.props.checkable?i.a.createElement(L.a,{onChange:this.props.onCheckChange,indeterminate:this.props.checkIndeterminate,checked:this.props.checked,style:{marginRight:"10px"}}):null,i.a.createElement(g.a,{type:"cloud"})," \u673a\u623f\uff1a",this.props.dcName||"\u9ed8\u8ba4"),i.a.createElement("div",{className:"host-view-vis-dc-content"},this.props.children))}}]),t}(i.a.Component))||r,U=Object(u.c)(o=function(e){function t(){return Object(b.a)(this,t),Object(y.a)(this,Object(k.a)(t).apply(this,arguments))}return Object(E.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return i.a.createElement(H.a,{title:i.a.createElement(i.a.Fragment,null,this.props.checkable?i.a.createElement(L.a,{onChange:this.props.onCheckChange,indeterminate:this.props.checkIndeterminate,checked:this.props.checked,style:{marginRight:"10px"}}):null,i.a.createElement(g.a,{type:"database"})," \u673a\u67b6\uff1a",this.props.rackName||"\u9ed8\u8ba4"),bodyStyle:{padding:0}},this.props.children)}}]),t}(i.a.Component))||o,W=Object(u.c)(c=function(e){function t(){var e,a;Object(b.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(y.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(r)))).handleClick=function(){a.props.clickable&&a.props.onClick&&a.props.onClick(a.props.host)},a}return Object(E.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:R()(["host-view-vis-host",{clickable:this.props.clickable}]),key:this.props.host.id,onClick:this.handleClick},this.props.checkable?i.a.createElement(L.a,{onChange:this.props.onCheckChange,checked:this.props.checked,style:{marginRight:"10px"}}):null,i.a.createElement("div",{className:"host-view-vis-host-content"},i.a.createElement("div",null,i.a.createElement(F.a.Text,null,this.props.host.name)),i.a.createElement("div",null,i.a.createElement(F.a.Text,{disabled:!0},this.props.host.username,"@",this.props.host.host,":",this.props.host.port)),this.props.children))}}]),t}(i.a.Component))||c,X=Object(u.c)(s=function(e){function t(){var e,a;Object(b.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(y.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(r)))).updateCheckedHost=function(e){a.props.onCheckedHostsChange&&a.props.onCheckedHostsChange(e)},a.handleHostCheckChange=function(e,t){a.updateCheckedHost(z({},a.props.checkedHosts,Object(A.a)({},e,t)))},a.handleRackCheckChange=function(e,t,n){var r={};N()(a.props.hosts).forEach((function(a){a.dc===e&&a.rack===t&&(r[a.id]=n)})),a.updateCheckedHost(z({},a.props.checkedHosts,{},r))},a.handleDcCheckChange=function(e,t){var n={};N()(a.props.hosts).forEach((function(a){a.dc===e&&(n[a.id]=t)})),a.updateCheckedHost(z({},a.props.checkedHosts,{},n))},a}return Object(E.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=this;if(0===Object.keys(this.props.hosts).length)return i.a.createElement("div",{style:{padding:"50px"}},i.a.createElement(I.a,{description:"\u60a8\u8fd8\u6ca1\u6709\u914d\u7f6e\u673a\u5668"}));var t=N()(this.props.hosts).groupBy("dc").toPairs().map((function(e){return[e[0],N()(e[1]).groupBy("rack").toPairs().sortBy(0).value()]})).sortBy(0).value(),a={},n={},r={},o={};if(this.props.checkable){for(var c in N.a.forEach(this.props.hosts,(function(e){a[e.dc]||(a[e.dc]=[]),a[e.dc].push(e),n[e.dc+"|"+e.rack]||(n[e.dc+"|"+e.rack]=[]),n[e.dc+"|"+e.rack].push(e)})),a){var s=!1,l=!1;a[c].forEach((function(t){e.props.checkedHosts&&e.props.checkedHosts[t.id]?s=!0:l=!0})),s&&l?r[c]={check:!0,indeterminate:!0}:s?r[c]={check:!0,indeterminate:!1}:l&&(r[c]={check:!1,indeterminate:!1})}for(var p in n){var h=!1,u=!1;n[p].forEach((function(t){e.props.checkedHosts[t.id]?h=!0:u=!0})),h&&u?o[p]={check:!0,indeterminate:!0}:h?o[p]={check:!0,indeterminate:!1}:u&&(o[p]={check:!1,indeterminate:!1})}}return i.a.createElement(i.a.Fragment,null,t.map((function(t){return i.a.createElement(Q,{dcName:t[0],key:t[0],checkable:e.props.checkable,checked:e.props.checkable&&r[t[0]].check,checkIndeterminate:e.props.checkable&&r[t[0]].indeterminate,onCheckChange:function(a){e.handleDcCheckChange(t[0],a.target.checked)}},N.a.chunk(t[1],3).map((function(a,n){return i.a.createElement(T.a,{gutter:16,key:n},a.map((function(a){return i.a.createElement(K.a,{span:8,key:a[0]},i.a.createElement(U,{rackName:a[0],key:a[0],checkable:e.props.checkable,checked:e.props.checkable&&o[t[0]+"|"+a[0]].check,checkIndeterminate:e.props.checkable&&o[t[0]+"|"+a[0]].indeterminate,onCheckChange:function(n){e.handleRackCheckChange(t[0],a[0],n.target.checked)}},a[1].map((function(t){return i.a.createElement(W,{host:t,key:t.id,clickable:e.props.clickable,onClick:e.props.onHostClick,checkable:e.props.checkable,checked:e.props.checkable&&e.props.checkedHosts[t.id],onCheckChange:function(a){e.handleHostCheckChange(t.id,a.target.checked)}},e.props.hostChildren?e.props.hostChildren[t.id]:null)}))))})))})))})))}}]),t}(i.a.Component))||s,Y=Object(u.b)("layers","hosts")(M=Object(u.c)(M=function(e){function t(){var e,a;Object(b.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(y.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(r)))).state={hostChecks:{}},a.handleCheckedHostsChange=function(e){a.setState({hostChecks:e})},a.handleSelectAll=function(){var e={};N.a.forEach(a.props.hosts.hosts,(function(t){return e[t.id]=!0})),a.setState({hostChecks:e})},a.handleDeSelectAll=function(){a.setState({hostChecks:{}})},a.handleNext=function(){var e=[];for(var t in a.state.hostChecks)a.state.hostChecks[t]&&e.push(t);0!==e.length?a.props.onNextStep&&a.props.onNextStep(e):_.a.error({title:"\u64cd\u4f5c\u5931\u8d25",content:"\u8bf7\u9009\u62e9\u81f3\u5c11\u4e00\u4e2a\u76ee\u6807\u673a\u5668\u7528\u4e8e\u90e8\u7f72 TiDB \u96c6\u7fa4"})},a}return Object(E.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=this,t=Object.keys(this.props.hosts.hosts).length>0;return i.a.createElement(H.a,{bordered:!1,title:"\u8bf7\u9009\u62e9\u90e8\u7f72 TiDB \u96c6\u7fa4\u7684\u76ee\u6807\u673a\u5668",bodyStyle:{padding:0},extra:i.a.createElement(V.a.Group,null,i.a.createElement(V.a,{onClick:function(){return e.props.layers.hostListVisible=!0}},"\u914d\u7f6e\u673a\u5668"),i.a.createElement(V.a,{onClick:function(){return e.props.layers.hostAddVisible=!0}},"\u521b\u5efa\u673a\u5668"),i.a.createElement(V.a,{onClick:this.handleSelectAll},"\u5168\u9009"),i.a.createElement(V.a,{onClick:this.handleDeSelectAll},"\u53d6\u6d88\u5168\u9009"))},t?i.a.createElement(i.a.Fragment,null,i.a.createElement(X,{hosts:this.props.hosts.hosts,checkable:!0,onCheckedHostsChange:this.handleCheckedHostsChange,checkedHosts:this.state.hostChecks}),i.a.createElement("div",{style:{padding:"16px"}},i.a.createElement(V.a,{type:"primary",onClick:this.handleNext},"\u4fdd\u5b58\u5e76\u9009\u62e9\u7ec4\u4ef6 ",i.a.createElement(g.a,{type:"right"})))):i.a.createElement(I.a,{description:"\u60a8\u8fd8\u6ca1\u6709\u914d\u7f6e\u673a\u5668"},i.a.createElement(V.a,{type:"primary",onClick:function(){return e.props.layers.hostAddVisible=!0}},"\u6dfb\u52a0\u673a\u5668")))}}]),t}(i.a.Component))||M)||M,Z=(a(202),a(26)),$=function(e){function t(){var e,a;Object(b.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(y.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(r)))).handleNext=function(){a.props.form.validateFields((function(e,t){e||a.props.onNextStep&&a.props.onNextStep(t)}))},a}return Object(E.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=this.props.form.getFieldDecorator;return i.a.createElement(H.a,{bordered:!1,title:"\u8bf7\u9009\u62e9\u9700\u8981\u90e8\u7f72\u7684 TiDB \u7ec4\u4ef6"},i.a.createElement(Z.a,{layout:"vertical"},i.a.createElement(Z.a.Item,{extra:"PD \u7ec4\u4ef6\u8d1f\u8d23\u534f\u8c03\u4e8b\u52a1\u4e0e\u8c03\u5ea6\u6570\u636e\uff0c\u5fc5\u9009"},i.a.createElement(L.a,{disabled:!0,checked:!0},"PD")),i.a.createElement(Z.a.Item,{extra:"TiKV \u7ec4\u4ef6\u8d1f\u8d23\u5b58\u50a8\u6570\u636e\uff0c\u5fc5\u9009"},i.a.createElement(L.a,{disabled:!0,checked:!0},"TiKV")),i.a.createElement(Z.a.Item,{extra:"TiDB \u7ec4\u4ef6\u63d0\u4f9b SQL \u5c42\u8ba1\u7b97\u529f\u80fd\uff0c\u82e5\u4e0d\u52fe\u9009\u5219\u53ea\u90e8\u7f72 KV \u6570\u636e\u5e93"},e("tidb",{valuePropName:"checked",initialValue:!0})(i.a.createElement(L.a,null,"TiDB"))),i.a.createElement(Z.a.Item,{extra:"\u6536\u96c6\u5e76\u5b58\u50a8\u6240\u6709\u7ec4\u4ef6\u53ca\u8282\u70b9\u7684\u76d1\u63a7\uff0c\u5e76\u63d0\u4f9b\u53ef\u89c6\u5316\u754c\u9762\u5c55\u793a"},e("metrics",{valuePropName:"checked",initialValue:!0})(i.a.createElement(L.a,null,"\u76d1\u63a7\uff08Prometheus\u3001Node Exporter \u53ca Grafana\uff09"))),i.a.createElement(Z.a.Item,{extra:"TiSpark \u7ec4\u4ef6\u53ef\u4ee5\u8ba1\u7b97\u5927\u578b\u5206\u6790\u578b SQL\uff08OLAP\uff09"},e("tispark",{valuePropName:"checked",initialValue:!1})(i.a.createElement(L.a,null,"TiSpark"))),i.a.createElement(Z.a.Item,{extra:"\u5728\u7ec4\u4ef6\u8fdb\u7a0b\u5d29\u6e83\u65f6\u57fa\u4e8e Supervise \u81ea\u52a8\u91cd\u542f\u7ec4\u4ef6\uff08\u6ce8\uff1a\u4e0d\u4f1a\u5f00\u673a\u81ea\u542f\u52a8\uff09"},e("supervise",{valuePropName:"checked",initialValue:!0})(i.a.createElement(L.a,null,"Supervise \u8fdb\u7a0b\u5b88\u62a4"))),i.a.createElement(V.a,{type:"primary",onClick:this.handleNext},"\u4fdd\u5b58\u5e76\u9884\u89c8\u90e8\u7f72\u65b9\u6848 ",i.a.createElement(g.a,{type:"right"}))))}}]),t}(i.a.Component),ee=Z.a.create({name:"deploy_components"})($),te=(a(409),a(71)),ae="red",ne="orange",re="magenta",oe="cyan",ce="blue",se="purple",le="gold",ie={pd:i.a.createElement(te.a,{key:"pd",color:ae},"PD"),tikv:i.a.createElement(te.a,{key:"tikv",color:ne},"TiKV"),tidb:i.a.createElement(te.a,{key:"tidb",color:re},"TiDB"),prometheus:i.a.createElement(te.a,{key:"prometheus",color:oe},"Prometheus"),node_exporter:i.a.createElement(te.a,{key:"node_exporter",color:ce},"NodeExporter"),grafana:i.a.createElement(te.a,{key:"grafana",color:se},"Grafana"),tispark:i.a.createElement(te.a,{key:"tispark",color:le},"TiSpark")},pe=Object(u.b)("hosts")(q=Object(u.c)(q=function(e){function t(){var e,a;Object(b.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(y.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(r)))).handleNext=function(){a.props.onNextStep&&a.props.onNextStep()},a}return Object(E.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=this;if(!this.props.topo)return null;var t=N()(this.props.hosts.hosts).toPairs().filter((function(t){return t[0]in e.props.topo})).fromPairs().value(),a={};for(var n in this.props.topo){var r=[];for(var o in this.props.topo[n])this.props.topo[n][o]&&r.push(ie[o]);a[n]=r}return i.a.createElement(H.a,{bordered:!1,title:"\u67e5\u770b\u5e76\u4fee\u6539\u90e8\u7f72\u65b9\u6848",bodyStyle:{padding:0}},i.a.createElement(H.a,null,i.a.createElement("div",null,i.a.createElement("p",null,"\u60a8\u53ef\u4ee5\u5728\u4e3b\u673a\u4e4b\u95f4\u62d6\u52a8\u7ec4\u4ef6\uff0c\u4ece\u800c\u4fee\u6539\u90e8\u7f72\u65b9\u6848\uff0c\u6216\u4ece\u6b64\u533a\u57df\u62d6\u52a8\u7ec4\u4ef6\u5230\u4e3b\u673a\u4e2d\u3002")),i.a.createElement("div",null,Object.values(ie))),i.a.createElement(X,{hosts:t,hostChildren:a}),i.a.createElement("div",{style:{padding:"16px"}},i.a.createElement(V.a,{type:"primary",onClick:this.handleNext,loading:this.props.inProgress},"\u5f00\u59cb\u90e8\u7f72 ",i.a.createElement(g.a,{type:"right"}))))}}]),t}(i.a.Component))||q)||q,he=a(89),ue=a.n(he),de=a(236),me=a.n(de);function be(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function fe(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?be(a,!0).forEach((function(t){Object(A.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):be(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var ye=function(e){function t(){return Object(b.a)(this,t),Object(y.a)(this,Object(k.a)(t).apply(this,arguments))}return Object(E.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{style:{display:this.props.show?"block":"none"}},this.props.children)}}]),t}(i.a.Component);function ke(e,t){var a=Number.MAX_VALUE,n=null;for(var r in e)if(!e[r][t]){var o=N.a.filter(Object.values(e[r])).length;o<a&&(a=o,n=r)}n&&(e[n][t]=!0)}var Ee,Oe,ve,ge=Object(u.b)("hosts")(G=Object(u.c)(G=Object(O.f)(G=function(e){function t(){var e,a;Object(b.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(y.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(r)))).state={tabKey:"hosts",hosts:[],topo:null,inSubmitProgress:!1},a.handleStartDeploy=function(){var e=[];for(var t in a.state.topo){var n=a.props.hosts.hosts[t],r=a.state.topo[t];r.tidb&&e.push({role:"tidb",server_ip:n.host,server_port:4e3,status_port:10080,data_dir:"/home/".concat(n.username,"/tidb")}),r.tikv&&e.push({role:"tikv",server_ip:n.host,server_port:20160,status_port:20180,data_dir:"/home/".concat(n.username,"/tikv")}),r.pd&&e.push({pd_id:ue()(),role:"pd",server_ip:n.host,server_port:20160,status_port:20180,data_dir:"/home/".concat(n.username,"/tikv")})}a.setState({inSubmitProgress:!0}),me.a.post("/submitTask",e).then((function(e){return console.log(e)}))},a}return Object(E.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement(m.a,null,i.a.createElement(m.a.Content,{style:{backgroundColor:"#FFF"}},i.a.createElement(P.a,{title:"\u90e8\u7f72",subTitle:"\u90e8\u7f72\u4e00\u4e2a\u65b0\u7684 TiDB / TiKV \u96c6\u7fa4",footer:i.a.createElement(x.a,{animated:!1,onChange:function(t){return e.setState({tabKey:t})},activeKey:this.state.tabKey},i.a.createElement(x.a.TabPane,{tab:"1. \u76ee\u6807\u673a\u5668",key:"hosts"}),i.a.createElement(x.a.TabPane,{tab:"2. \u7ec4\u4ef6",key:"components",disabled:0===this.state.hosts.length}),i.a.createElement(x.a.TabPane,{tab:"3. \u90e8\u7f72\u65b9\u6848",key:"view_topo",disabled:!this.state.topo}))})),i.a.createElement(m.a.Content,{style:{padding:"20px"}},i.a.createElement(ye,{show:"hosts"===this.state.tabKey},i.a.createElement(Y,{onNextStep:function(t){e.setState({hosts:t,tabKey:"components"})}})),i.a.createElement(ye,{show:"components"===this.state.tabKey},i.a.createElement(ee,{onNextStep:function(t){var a=function(e,t){var a=fe({},t);if(delete a.supervise,a.metrics&&(a.prometheus=!0,a.node_exporter=!0,a.grafana=!0,delete a.metrics),0===e.length)throw new Error("\u5fc5\u987b\u9009\u62e9\u81f3\u5c11\u4e00\u4e2a\u76ee\u6807\u673a\u5668\u90e8\u7f72 TiDB \u7ec4\u4ef6");var n={};if(e.forEach((function(e){return n[e]={}})),1===e.length)return n[e[0]]=a,n;if(a.node_exporter&&(e.forEach((function(e){return n[e].node_exporter=!0})),delete a.node_exporter),2===e.length){for(var r in a)a[r]&&ke(n,r);return n}var o=Math.max(e.length,3);a.tidb&&(o=Math.max(~~(e.length/2),3));for(var c=0;c<o;c++)ke(n,"tikv");a.tikv=!1;for(var s=0;s<3;s++)ke(n,"pd");if(a.pd=!1,a.tidb){for(var l=~~(e.length/2),i=0;i<l;i++)ke(n,"tidb");a.tidb=!1}for(var p in a)a[p]&&ke(n,p);return n}(e.state.hosts,fe({},t,{pd:!0,tikv:!0}));e.setState({tabKey:"view_topo",topo:a})}})),i.a.createElement(ye,{show:"view_topo"===this.state.tabKey},i.a.createElement(pe,{topo:this.state.topo,onNextStep:this.handleStartDeploy,inProgress:this.state.inSubmitProgress}))))}}]),t}(i.a.Component))||G)||G)||G,je=(a(464),a(177)),Ce=a(238),Se=a(237),we=a.n(Se),Pe=function(e){function t(){var e,a;Object(b.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(y.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(r)))).state={tasks:[]},a}return Object(E.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params.id,a=we()();a.on("connect",(function(){a.emit("deploy",{task_id:t})})),a.on("sync",(function(t){e.setState({tasks:t.steps})})),a.on("task",(function(t){e.state.tasks.forEach((function(a,n){a.step_id==t.step_id&&(e.state.tasks[n]=a)})),e.setState({tasks:Object(Ce.a)(e.state.tasks)})})),this.socket=a}},{key:"componentWillUnmount",value:function(){this.socket&&(this.socket.removeAllListeners(),this.socket.close(),this.socket=null)}},{key:"render",value:function(){var e={finished:i.a.createElement(g.a,{type:"check-circle",spin:!0,style:{color:"#37b24d"}}),unfinished:null,running:i.a.createElement(g.a,{type:"loading",spin:!0,style:{color:"#fa5252"}})};return i.a.createElement(m.a,null,i.a.createElement(m.a.Content,{style:{backgroundColor:"#FFF"}},i.a.createElement(P.a,{title:"\u90e8\u7f72\u8fdb\u5ea6",subTitle:"\u6b63\u5728\u90e8\u7f72\u96c6\u7fa4..."})),i.a.createElement(m.a.Content,{style:{padding:"20px"}},i.a.createElement(H.a,{bordered:!1},i.a.createElement(je.a,{bordered:!0,dataSource:this.state.tasks,renderItem:function(t){return i.a.createElement(je.a.Item,{style:{display:"flex",flexDirection:"row"}},i.a.createElement("div",{style:{width:"60px"}},e[t.status]),i.a.createElement("div",null,t.msg))}}))))}}]),t}(i.a.Component),xe=(a(228),a(141)),Ae=Object(u.b)("layers","hosts")(Ee=Object(u.c)(Ee=function(e){function t(){var e,a;Object(b.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(y.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(r)))).state={hostChecks:{}},a.handleCheckedHostsChange=function(e){a.setState({hostChecks:e})},a.handleSelectAll=function(){var e={};N.a.forEach(a.props.hosts.hosts,(function(t){return e[t.id]=!0})),a.setState({hostChecks:e})},a.handleDeSelectAll=function(){a.setState({hostChecks:{}})},a}return Object(E.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement(xe.a,{closable:!0,title:i.a.createElement("span",null,i.a.createElement(g.a,{type:"deployment-unit"})," \u914d\u7f6e\u673a\u5668"),placement:"right",visible:this.props.layers.hostListVisible,onClose:function(){return e.props.layers.hostListVisible=!1},zIndex:500,width:"100vw",drawerStyle:{background:"#f0f2f5"},bodyStyle:{padding:0}},i.a.createElement(m.a.Content,{style:{background:"#FFF",padding:"16px"}},i.a.createElement(V.a,{type:"primary",onClick:function(){return e.props.layers.hostAddVisible=!0},style:{marginRight:"10px"}},"\u521b\u5efa\u673a\u5668"),i.a.createElement(V.a.Group,{style:{marginRight:"10px"}},i.a.createElement(V.a,{onClick:this.handleSelectAll},"\u5168\u9009"),i.a.createElement(V.a,{onClick:this.handleDeSelectAll},"\u53d6\u6d88\u5168\u9009")),i.a.createElement(V.a.Group,{style:{marginRight:"10px"}},i.a.createElement(V.a,null,"\u6279\u91cf\u7f16\u8f91"),i.a.createElement(V.a,null,"\u6279\u91cf\u5220\u9664"))),i.a.createElement(X,{hosts:this.props.hosts.hosts,clickable:!0,checkable:!0,onHostClick:function(e){return console.log(e)},onCheckedHostsChange:this.handleCheckedHostsChange,checkedHosts:this.state.hostChecks}))}}]),t}(i.a.Component))||Ee)||Ee,De=(a(200),a(53)),Ne=(a(461),a(108)),He=(a(213),a(65)),Ie=a(15);function Ve(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}var _e,Te,Ke,Fe,Le,Be,Re,Je,ze,Me=Object(u.b)("hosts")(Oe=Object(u.c)(Oe=function(e){function t(){var e,a;Object(b.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(y.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(r)))).state={isPubKeyAuth:!1,templateValue:void 0},a.handleChangeAuthMethod=function(e){a.setState({isPubKeyAuth:e.target.checked})},a.handleSubmit=function(){a.props.form.validateFields((function(e,t){e||a.props.onSubmit&&a.props.onSubmit(t,!0)}))},a.handleSubmitAndNew=function(){a.props.form.validateFields((function(e,t){e||a.props.onSubmit&&(a.props.onSubmit(t,!1),a.handleReset())}))},a.handleReset=function(){a.props.form.resetFields(),a.setState({templateValue:void 0})},a.handleTemplateChange=function(e){a.setState({templateValue:e});var t=Object(Ie.o)(a.props.hosts.hosts[e]);a.props.form.setFieldsValue(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ve(a,!0).forEach((function(t){Object(A.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ve(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},t,{name:"",host:""}))},a}return Object(E.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=this.props.form.getFieldDecorator;return i.a.createElement(Z.a,{layout:"vertical"},i.a.createElement(Ne.a,{bordered:!1,defaultActiveKey:["import","basic"]},i.a.createElement(Ne.a.Panel,{header:"\u5bfc\u5165\u6a21\u677f",key:"import"},i.a.createElement(Z.a.Item,{label:"\u4ece\u73b0\u6709\u4e3b\u673a\u914d\u7f6e\u590d\u5236"},i.a.createElement(He.a,{showSearch:!0,placeholder:"\u9009\u62e9\u4e3b\u673a",optionFilterProp:"children",filterOption:function(e,t){return(t.props.label.toLowerCase()+"|"+t.props.value.username+"@"+t.props.value.host+":"+t.props.value.port).indexOf(e.toLowerCase())>=0},optionLabelProp:"label",onChange:this.handleTemplateChange,value:this.state.templateValue},Object.values(this.props.hosts.hosts).map((function(e){return i.a.createElement(He.a.Option,{value:e.id,label:e.name,key:e.id},i.a.createElement("div",null,e.name),i.a.createElement("div",null,i.a.createElement(F.a.Text,{disabled:!0},e.username,"@",e.host,":",e.port)))}))))),i.a.createElement(Ne.a.Panel,{header:"\u8be6\u7ec6\u914d\u7f6e",key:"basic"},i.a.createElement(Z.a.Item,{label:"\u552f\u4e00\u540d\u79f0"},e("name")(i.a.createElement(De.a,{placeholder:"\u7559\u7a7a\u81ea\u52a8\u751f\u6210"}))),i.a.createElement(Z.a.Item,{label:"\u5730\u5740"},e("host",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4e3b\u673a\u5730\u5740"}]})(i.a.createElement(De.a,{placeholder:"\u4e3b\u673a\u5730\u5740\uff0cIP \u6216\u57df\u540d"}))),i.a.createElement(Z.a.Item,{label:"\u7aef\u53e3"},e("port",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7aef\u53e3"}],initialValue:"22"})(i.a.createElement(De.a,null))),i.a.createElement(Z.a.Item,{label:"\u767b\u5f55\u7528\u6237\u540d"},e("username",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u767b\u5f55\u7528\u6237\u540d"}]})(i.a.createElement(De.a,null))),i.a.createElement(Z.a.Item,null,e("isPubKeyAuth",{initialValue:!1})(i.a.createElement(L.a,{checked:this.state.isPubKeyAuth,onChange:this.handleChangeAuthMethod},"\u4f7f\u7528\u79c1\u94a5\u767b\u5f55"))),this.state.isPubKeyAuth?i.a.createElement(i.a.Fragment,null,i.a.createElement(Z.a.Item,{label:"\u79c1\u94a5"},e("privateKey",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u79c1\u94a5"}]})(i.a.createElement(De.a.TextArea,null))),i.a.createElement(Z.a.Item,{label:"\u79c1\u94a5\u5bc6\u7801"},e("privateKeyPassword")(i.a.createElement(De.a.Password,null)))):i.a.createElement(Z.a.Item,{label:"\u5bc6\u7801"},e("password",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u767b\u5f55\u5bc6\u7801"}]})(i.a.createElement(De.a.Password,null)))),i.a.createElement(Ne.a.Panel,{header:"\u9ad8\u7ea7\u914d\u7f6e",key:"advanced"},i.a.createElement(Z.a.Item,{label:"\u4f4d\u7f6e\u6807\u7b7e: DC"},e("dc",{initialValue:""})(i.a.createElement(De.a,null))),i.a.createElement(Z.a.Item,{label:"\u4f4d\u7f6e\u6807\u7b7e: Rack"},e("rack",{initialValue:""})(i.a.createElement(De.a,null))))),i.a.createElement("div",{style:{margin:"16px"}},i.a.createElement(V.a,{type:"primary",onClick:this.handleSubmit},"\u6dfb\u52a0"),"\xa0",i.a.createElement(V.a,{onClick:this.handleSubmitAndNew},"\u4fdd\u5b58\u5e76\u6dfb\u52a0\u4e0b\u4e00\u4e2a"),"\xa0",i.a.createElement(V.a,{onClick:this.handleReset},"\u91cd\u7f6e")))}}]),t}(i.a.Component))||Oe)||Oe,qe=Z.a.create({name:"add_form"})(Me),Ge=Object(u.b)("layers","hosts")(ve=Object(u.c)(ve=function(e){function t(){var e,a;Object(b.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(y.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(r)))).handleSubmit=function(e,t){a.props.hosts.addHost(e)&&t&&(a.props.layers.hostAddVisible=!1)},a}return Object(E.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement(xe.a,{closable:!0,destroyOnClose:!0,title:"\u6dfb\u52a0 SSH \u8fdc\u7a0b\u4e3b\u673a",placement:"right",visible:this.props.layers.hostAddVisible,onClose:function(){return e.props.layers.hostAddVisible=!1},zIndex:501,width:400,bodyStyle:{padding:0}},i.a.createElement(qe,{onSubmit:this.handleSubmit}))}}]),t}(i.a.Component))||ve)||ve,Qe=function(e){function t(){return Object(b.a)(this,t),Object(y.a)(this,Object(k.a)(t).apply(this,arguments))}return Object(E.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return i.a.createElement(m.a,{style:{minHeight:"100vh"}},i.a.createElement(S,null),i.a.createElement(m.a.Content,null,i.a.createElement(O.c,null,i.a.createElement(O.a,{exact:!0,path:"/"},i.a.createElement(w,null)),i.a.createElement(O.a,{path:"/deploy"},i.a.createElement(ge,null)),i.a.createElement(O.a,{path:"/progress/:id",component:Pe}))),i.a.createElement(Ae,null),i.a.createElement(Ge,null))}}]),t}(l.Component),Ue=a(79),We=a(57),Xe=(a(171),new(_e=function e(){Object(b.a)(this,e),Object(Ue.a)(this,"hostListVisible",Te,this),Object(Ue.a)(this,"hostAddVisible",Ke,this)},Te=Object(We.a)(_e.prototype,"hostListVisible",[Ie.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ke=Object(We.a)(_e.prototype,"hostAddVisible",[Ie.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_e)),Ye=new(Fe=Ie.d.bound,Le=function(){function e(){Object(b.a)(this,e),Object(Ue.a)(this,"hosts",Be,this),this.addHost({name:"uhost-ap3kilnh",host:"10.9.164.80",username:"root",password:"abc",port:22,dc:"ucloud-1"}),this.addHost({name:"uhost-kesclakw",host:"10.9.136.246",username:"root",password:"abc",port:22,dc:"ucloud-1",rack:"test_rack"}),this.addHost({name:"uhost-ou3hu5yx",host:"10.9.158.146",username:"root",password:"abc",port:22}),this.addHost({name:"uhost-x2ofoajg",host:"10.9.111.178",username:"root",password:"abc",port:22,dc:"ucloud-1",rack:"test_rack"})}return Object(f.a)(e,[{key:"addHost",value:function(e){return e.name||(e.name="".concat(e.username,"@").concat(e.host,":").concat(e.port)),e.port=parseInt(e.port),e.port?-1!==Object.values(this.hosts).map((function(e){return e.host})).indexOf(e.host)?(_.a.error({title:"\u6dfb\u52a0\u5931\u8d25",content:"\u4e3b\u673a ".concat(e.host," \u5df2\u5b58\u5728\uff0c\u4e0d\u80fd\u91cd\u590d\u6dfb\u52a0")}),!1):-1!==Object.values(this.hosts).map((function(e){return e.name})).indexOf(e.name)?(_.a.error({title:"\u6dfb\u52a0\u5931\u8d25",content:"\u552f\u4e00\u540d\u79f0 ".concat(e.name," \u5df2\u5b58\u5728\uff0c\u4e0d\u80fd\u91cd\u590d\u6dfb\u52a0")}),!1):(e.id=ue()(),e.dc=e.dc||"",e.rack=e.rack||"",this.hosts[e.id]=e,!0):(_.a.error({title:"\u6dfb\u52a0\u5931\u8d25",content:"\u65e0\u6548\u7aef\u53e3"}),!1)}}]),e}(),Be=Object(We.a)(Le.prototype,"hosts",[Ie.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),Object(We.a)(Le.prototype,"addHost",[Fe],Object.getOwnPropertyDescriptor(Le.prototype,"addHost"),Le.prototype),Le),Ze=new(Re=Ie.d.bound,Je=function(){function e(){Object(b.a)(this,e),Object(Ue.a)(this,"deployments",ze,this)}return Object(f.a)(e,[{key:"addDeployment",value:function(e,t,a){var n={id:ue()(),hosts:JSON.parse(JSON.stringify(e)),config:JSON.parse(JSON.stringify(t)),topology:JSON.parse(JSON.stringify(a))};return this.deployments[n.id]=n,!0}}]),e}(),ze=Object(We.a)(Je.prototype,"deployments",[Ie.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),Object(We.a)(Je.prototype,"addDeployment",[Re],Object.getOwnPropertyDescriptor(Je.prototype,"addDeployment"),Je.prototype),Je);h.a.render(i.a.createElement(d.a,null,i.a.createElement(u.a,{hosts:Ye,deployments:Ze,layers:Xe},i.a.createElement(Qe,null))),document.getElementById("root"))}},[[240,1,2]]]);
//# sourceMappingURL=main.8aa4c33a.chunk.js.map